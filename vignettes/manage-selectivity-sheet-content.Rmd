---
title: "Manage selectivity sheet content"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{manage-selectivity-sheet-content}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(inser)
```

<!-- WARNING - This vignette is generated by {fusen} from /dev/flat_utils_selectivity_sheet.Rmd: do not edit by hand -->

```{r pkg}
library(ggplot2)
```

# Translating selectivity sheets

## `create_translate_dict()` : generate object with translated text

This function will provide all the necessary text to generate the selectivity sheet in the required language. The text is stored in a named list that will be accessible when calling the `create_selectivity_sheet()` function.


```{r examples-create_translate_dict}
# create the EN translator
lg <- create_translate_dict(language = "EN")

# call main title by its ID
cat(lg[["0_main_title"]])

# create the FR translator
lg <- create_translate_dict(language = "FR")

# call main title by its ID
cat(lg[["0_main_title"]])
```

Once the translation list object is loaded in the environment, we can call it inside Rmd chunks to display the correct text. We can call this translator at several places, as explained below.

* **Translating file title and subtitle**
  - edit yaml header
  - _example_ : c.f. chunk below
  

```{r vign-header, eval = FALSE, echo = TRUE}
---
title: "`r lg[['0_main_title']]`"
subtitle: "`r lg[['0_sub_title_twin']]`"
output: word_document
---
```

* **Translating chapter and text**
  - use inline r evaluation code
  - _example_ : `` `r
lg[['0_main_title']]` `` will be shown in the text as : `r lg[['0_main_title']]`

<!-- line break in r inline code prevents it to be evaluated so we can show the verbatim -->

* **Translating graph caption and labels**
  - use direct call to the list object
  - _example_ :
      - using `fig.cap = lg[['1_duration_caption']]` in chunk header will render the proper plot caption
      - using `labs(y = lg[["1_duration_labs"]])` in the ggplot construction will render the proper plot label
  

```{r vign-data, include = FALSE}
# load example dataset with missing fishing duration
tab_OP <- structure(
  list(
    project = c("InseR", "InseR", "InseR", "InseR","InseR", "InseR"),
    vessel_identifier = c("vessel1","vessel1","vessel1","vessel1","vessel1","vessel1"),
    trip_code = c(3,3, 3, 3, 3, 3),
    station_number = c(3L, 5L, 8L, 10L, 13L, 14L),
    fishing_duration = c(3.75, 4, 3, 4, 3, 4),
    gear_depth = c(99L, 104L, 103L, 99L, 97L, 93L),
    wind_force_beaufort = c(4L,5L, 5L, 4L, 4L, 3L),
    gear_speed = c(3.5,3.5,3.40000009536743,3.40000009536743,3.70000004768372,4),
    sea_state = c(4L,5L, 5L, 4L, 4L, 3L)
  ),
  class = "data.frame",
  row.names = c(NA, -6L)
)
```

```{r vign-graph, echo = TRUE, fig.cap = lg[['1_duration_caption']]}
ggplot(tab_OP, aes(y = fishing_duration)) +
  geom_boxplot(width = 0.5) +
  labs(y = lg[["1_duration_labs"]])
```

* **Translating text outputs**
  - prefer the use of `sprintf()` instead of `paste0()` to enable the text to be provided as a single character line
  - _example_ : c.f. chunk below


```{r vign-sprintf}
# Get dummy variable values
nNA <- 2
nrow_info <- 10

# the sprintf character loaded is : "Note : il manque %i valeurs sur les %i opérations de pêche."

# Generate message with sprintf and lg object
if(nNA>0){
  cat(sprintf(lg[["1_missing_values"]], nNA, nrow_info))
}
```

  

* **Rendering report**
  - Once the report is correctly including the calls to the translation object, we can render it with `rmarkdown::render()`
  - Language of rendering will depend on the pre-loaded translation object
  - _example_ : c.f. chunk below rendering the example `selectivity_sheet_template.Rmd` file in both EN and FR
  
> The path to the template and its docx outputs can be retrieved with `system.file("template", package = "inser")`.


```{r vign-render}
# select template file
template_file <- system.file("template","selectivity_sheet_template.Rmd", package = "inser")

# load EN translation object
lg <- create_translate_dict(language = "EN")

# render template (will generate EN report)
rmarkdown::render(input = template_file,
       output_file = "selectivity_sheet_en.docx",
       quiet = TRUE)

# create the FR translator
lg <- create_translate_dict(language = "FR")

# render template (will generate FR report)
rmarkdown::render(input = template_file,
       output_file = "selectivity_sheet_fr.docx",
       quiet = TRUE)
```

