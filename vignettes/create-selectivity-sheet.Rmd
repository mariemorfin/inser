---
title: "Create selectivity sheet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{create-selectivity-sheet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(inser)
```

<!-- WARNING - This vignette is generated by {fusen} from /dev/flat_create_selectivity_sheet.Rmd: do not edit by hand -->

## Sythetic sheet of fishing gear selectivity

<div align="center">**Acronyms**</div>

STD: stands for the standard fishing gear usually used, it is the reference gear 

TEST: stands for the gear modified with a new selective device to be tested

LAN: Fraction of the catch retained by the fisherman (= Landings)

DIS: Part of the catch not retained by the fisherman (= Discards)

FO: Fishing Operation

The sheet is generated in Word format for easy editing. It presents 'relative' selectivity indicators between the TEST gear and the STD gear. They quantify and characterize the improvement or decrease in the selectivity of the TEST gear compared to the STD gear.

<br>

- Gear characteristics: Name, mesh size, selective device


### 1.	Description of the sea trial

&rarr; This section characterizes the conditions associated with the selectivity experiment. It also allows us to verify whether the fishing operations were carried out under similar conditions in the case of a paired protocol.

&rarr;	Number of FOs and trials, dates of trials

-	Boxplot by gear and scatterplot (TEST vs. STD) of fishing duration, fishing speed, depth, time of day, sea state, current speed, current direction, bottom type, catch weight.


### 2.	Catch analysis

#### 2.1.	Discard weight and sorting time

- Boxplots of total discard weights (LAN) and sorting time by FO of both gears (STD and TEST)
- Test to compare the mean or median of catches
- Estimation of the reduction in sorting time


#### 2.2.	Weight per species

- **LAN biomass for a defined list of species**

  - Boxplots of LAN weights for both gears (STD and TEST)
  - Comparison test of the mean or median of the weights caught over the whole trial by each gear
  - Estimation of the variation of the LAN on the cumulated weights caught and intra pairs

- **DIS biomass for a defined list of discarded species**

  - Distribution of DIS weights of both gears
  - Comparison test of the mean or median of the weights caught at the scale of the FO 
  - Estimation of cumulative and intra-pair variation in DIS



### 3.	Size selectivity for a defined list of species

- Histograms of length distribution of the catches of the two gears (from the total catch and by fraction)
- Relative selectivity by size class (TEST/(TEST+STD))
- Estimate of the escapement rate of individuals below commercial size (1-TEST/STD)



# `create_selectivity_sheet()`

```{r examples-create_selectivity_sheet}
# Create tmp folder
output_dir <- tempfile(pattern = "inser")
dir.create(output_dir)

# Setup input OTT data
OTT_data_folder <- system.file("script_origin","Data","Example_OTT", package = "inser")

TR <- readr::read_delim(
  file = file.path(OTT_data_folder, "TR.csv"),
  delim = ";",
  escape_double = FALSE,
  locale = readr::locale(encoding = "WINDOWS-1252"),
  trim_ws = TRUE
)

HH<-read.table(
  file.path(OTT_data_folder, "HH.csv"),
  sep=";",
  header=TRUE,
  encoding = "WINDOWS-1252")#,colClasses = colClasses)

SL<-read.table(
  file.path(OTT_data_folder, "SL.csv"),
  sep=";",
  header=TRUE,
  encoding = "WINDOWS-1252")

HL<-read.table(
  file.path(OTT_data_folder, "HL.csv"),
  sep=";",
  header=TRUE,
  encoding = "WINDOWS-1252")

colClasses<-rep(NA,ncol(HH))
colClasses[which(names(HH)=="statistical_rectangle")]<-"character"

HH<-read.table(
  file.path(OTT_data_folder, "HH.csv"),
  sep=";",
  header=TRUE,
  colClasses = colClasses,
  encoding = "WINDOWS-1252")

# create TAB output
TAB <- prep_sel_data(data=list(TR,HH,SL,HL))

# Setup zone and min_length params
min_length <- data.frame(species=unique(TAB$species),min_length=c(27,24,20,NA,27,NA))
zones <- c("8.a","8.b","7.d","7.e","7.h")

# run function
create_selectivity_sheet(data = TAB,
                         output_dir = output_dir,
                         output_file = "fiche_InseR_twin",
                         protocol = "twin",
                         language = "FR",
                         zones=zones,
                         min_length=min_length)

# Clear tmp folder
unlink(output_dir, recursive = TRUE)
```

